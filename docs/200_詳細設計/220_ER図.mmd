erDiagram
  m_companies {
    uuid id PK
    string name
    string code
    string timezone
    string currency
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  m_users {
    uuid id PK
    string email
    string family_name
    string first_name
    string family_name_kana
    string first_name_kana
    string status "active|inactive|locked"
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  r_company_memberships {
    uuid id PK
    uuid company_id FK
    uuid user_id FK
    string role "system_admin|admin|manager|employee"
    datetime joined_at
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  m_groups {
    uuid id PK
    uuid company_id FK
    string type
    string name
    string code
    uuid parent_group_id FK
    int sort_order
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  m_employees {
    uuid id PK
    uuid company_id FK
    uuid user_id FK
    string employee_no
    string employment_type
    date hire_date
    date termination_date
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  h_employee_groups {
    uuid id PK
    uuid company_id FK
    uuid employee_id FK
    uuid group_id FK
    string role_in_group "leader|member"
    date valid_from
    date valid_to
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  m_shift_templates {
    uuid id PK
    uuid company_id FK
    string name
    time default_start
    time default_end
    int break_minutes
    bool is_night_shift
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  r_shift_break_templates {
    uuid id PK
    uuid company_id FK
    uuid shift_template_id FK
    time break_start
    time break_end
    string break_name
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  r_shift_assignments {
    uuid id PK
    uuid company_id FK
    uuid employee_id FK
    date work_date
    uuid shift_template_id FK
    uuid group_id FK
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  h_time_clock_events {
    uuid id PK
    uuid company_id FK
    uuid employee_id FK
    datetime happened_at
    string type "in|out|break_in|break_out"
    string source "web|mobile|ic_card|admin"
    string note
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  t_time_records {
    uuid id PK
    uuid company_id FK
    uuid employee_id FK
    date work_date
    datetime start_at
    datetime end_at
    int break_minutes
    int work_minutes
    int overtime_minutes
    int night_minutes
    string status "draft|submitted|approved|rejected|locked"
    uuid submitted_by FK
    datetime submitted_at
    uuid approved_by FK
    datetime approved_at
    uuid group_id FK
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  t_approval_requests {
    uuid id PK
    uuid company_id FK
    string target_type "time_record|leave_request"
    uuid target_id
    uuid requester_user_id FK
    uuid current_approver_user_id FK
    string status "pending|approved|rejected|canceled"
    datetime requested_at
    datetime resolved_at
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  h_approval_steps {
    uuid id PK
    uuid company_id FK
    uuid approval_request_id FK
    int step_no
    uuid approver_user_id FK
    string status "pending|approved|rejected|skipped"
    datetime acted_at
    string comment
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  m_leave_types {
    uuid id PK
    uuid company_id FK
    string name
    string code
    bool is_paid
    bool requires_approval
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  t_leave_requests {
    uuid id PK
    uuid company_id FK
    uuid employee_id FK
    uuid leave_type_id FK
    date start_date
    date end_date
    decimal days
    string status "draft|submitted|approved|rejected|canceled"
    string reason
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  m_payroll_calendars {
    uuid id PK
    uuid company_id FK
    string name
    int closing_day
    int payday_day
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  t_payroll_periods {
    uuid id PK
    uuid company_id FK
    uuid payroll_calendar_id FK
    date period_start
    date period_end
    date closing_date
    date pay_date
    string status "open|closed|calculated|finalized"
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  h_compensation_plans {
    uuid id PK
    uuid company_id FK
    uuid employee_id FK
    string pay_type
    decimal base_salary
    decimal hourly_rate
    decimal overtime_rate
    decimal night_rate
    date effective_from
    date effective_to
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  m_pay_items {
    uuid id PK
    uuid company_id FK
    string code
    string name
    string type
    bool taxable
    int sort_order
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  t_payslips {
    uuid id PK
    uuid company_id FK
    uuid payroll_period_id FK
    uuid employee_id FK
    string status "draft|confirmed|paid"
    decimal gross
    decimal total_deduction
    decimal net
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  r_payslip_lines {
    uuid id PK
    uuid company_id FK
    uuid payslip_id FK
    uuid pay_item_id FK
    decimal quantity
    decimal unit_amount
    decimal amount
    string note
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  t_payments {
    uuid id PK
    uuid company_id FK
    uuid payroll_period_id FK
    date pay_date
    string method "bank_transfer|cash"
    string status "scheduled|processing|done|failed"
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  r_payment_lines {
    uuid id PK
    uuid company_id FK
    uuid payment_id FK
    uuid payslip_id FK
    decimal amount
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  h_audit_logs {
    uuid id PK
    uuid company_id FK
    uuid actor_user_id FK
    string action
    string target_type "m_users|m_employees|etc"
    uuid target_id
    json before_data
    json after_data
    string request_id
    datetime happened_at
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  t_job_runs {
    uuid id PK
    uuid company_id FK
    string job_type "payroll_calculation|etc"
    string status "running|success|failed|canceled"
    string request_id
    datetime started_at
    datetime finished_at
    json params
    json result
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  h_job_run_events {
    uuid id PK
    uuid company_id FK
    uuid job_run_id FK
    string level
    string message
    json metadata
    datetime happened_at
    datetime created_at
    uuid created_by
    datetime updated_at
    uuid updated_by
    datetime deleted_at
    uuid deleted_by
  }

  m_companies ||--o{ r_company_memberships : has
  m_users ||--o{ r_company_memberships : joins

  m_companies ||--o{ m_groups : has
  m_groups ||--o{ m_groups : parent_child

  m_companies ||--o{ m_employees : employs
  m_employees ||--o{ h_compensation_plans : set_to
  m_users ||--o{ m_employees : maps_to

  m_employees ||--o{ h_employee_groups : belongs
  m_groups ||--o{ h_employee_groups : includes

  m_companies ||--o{ h_compensation_plans : has
  m_companies ||--o{ m_shift_templates : has
  m_shift_templates ||--o{ r_shift_break_templates : contains
  m_employees ||--o{ r_shift_assignments : scheduled
  m_shift_templates ||--o{ r_shift_assignments : uses
  m_groups ||--o{ r_shift_assignments : "group(type=work_location)"

  m_employees ||--o{ h_time_clock_events : generates
  m_employees ||--o{ t_time_records : has
  m_groups ||--o{ t_time_records : "group(type=cost_center)"

  m_companies ||--o{ t_approval_requests : has
  t_approval_requests ||--o{ h_approval_steps : contains

  m_companies ||--o{ m_leave_types : defines
  m_employees ||--o{ t_leave_requests : requests
  m_leave_types ||--o{ t_leave_requests : categorized

  m_companies ||--o{ m_payroll_calendars : has
  m_payroll_calendars ||--o{ t_payroll_periods : creates
  t_payroll_periods ||--o{ t_payslips : generates
  m_employees ||--o{ t_payslips : receives
  t_payslips ||--o{ r_payslip_lines : details
  m_companies ||--o{ m_pay_items : defines
  m_pay_items ||--o{ r_payslip_lines : used_by

  t_payroll_periods ||--o{ t_payments : pays
  t_payments ||--o{ r_payment_lines : lines
  t_payslips ||--o{ r_payment_lines : settled_by

  m_companies ||--o{ h_audit_logs : has
  m_users ||--o{ h_audit_logs : acts

  m_companies ||--o{ t_job_runs : runs
  t_job_runs ||--o{ h_job_run_events : logs
