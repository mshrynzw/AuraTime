# API基本方針

## 1. REST原則
本システムはRESTful APIを採用します。

- **GET**: リソースの取得、一覧表示
- **POST**: リソースの作成、アクションの実行（計算、承認等）
- **PUT / PATCH**: リソースの更新（PATCH推奨）
- **DELETE**: リソースの削除（内部的にはソフト削除）

## 2. 認証・認可
- **方式**: JWT (JSON Web Token) またはセッションベース認証。
- **改ざん防止 (Critical)**:
    - APIリクエストのパスやボディに含まれる `company_id` よりも、**認証トークンに埋め込まれた `company_id` を優先**する。
    - 他社のIDを指定した場合、403 Forbidden または 404 Not Found を返却し、データ侵害を完全に防止する。

## 3. 共通レスポンスフォーマット

成功時：
```json
{
  "success": true,
  "data": { ... },
  "request_id": "req-12345678"
}
```

エラー時：
```json
{
  "success": false,
  "error": {
    "code": "INVALID_PARAMETER",
    "message": "入力値が不正です。",
    "details": [ ... ]
  },
  "request_id": "req-12345678"
}
```

## 4. 特殊なヘッダ
- `X-Request-Id`: クライアントまたはゲートウェイで生成されたUUID。
    - SYSTEM_LOGS, 監査ログ, ジョブログのすべてにこのIDを記録し、調査時の紐付けに使用する。

## 5. ページング・ソート
- ページング: `?limit=20&offset=0`
- ソート: `?sort=happened_at:desc,id:asc`

## 6. IDの扱い
- すべてのIDには **UUID v4** を使用する。
- 外部露出するIDもUUIDとし、推測可能な連番（シークエンス）は避ける。

