# 開発ガイドライン

## 1. 概要

本ドキュメントは、AuraTimeシステムの開発における進捗管理、リスク管理、開発時の注意事項を定義します。

## 2. 進捗管理

### 2.1 マイルストーン

| マイルストーン | フェーズ | 完了基準 |
| :--- | :--- | :--- |
| **M1: 認証基盤完成** | Phase 0 | 認証・認可が正常に動作し、マルチテナント分離が確認できる |
| **M2: MVP完成** | Phase 1 | 従業員が打刻し、勤怠を確認できる |
| **M3: 業務プロセス完成** | Phase 2 | 勤怠修正申請、休暇申請、シフト管理が正常に動作する |
| **M4: 給与機能完成** | Phase 3 | 給与計算、明細管理、支払管理が正常に動作する |
| **M5: システム完成** | Phase 4 | 全ての機能が正常に動作し、システム管理機能が利用可能 |

### 2.2 各フェーズの完了基準

各フェーズは以下の条件を満たした時点で完了とします：

1. **機能要件**: そのフェーズで定義された全ての機能が実装されている
2. **テスト**: 全てのテストがパスしている
3. **ドキュメント**: API仕様書が更新されている
4. **コードレビュー**: コードレビューが完了している
5. **動作確認**: 動作確認が完了している

### 2.3 進捗報告

各フェーズの進捗は以下の方法で報告します：

- **日次**: 開発状況の共有（チーム内）
- **週次**: 進捗報告と課題の共有
- **フェーズ完了時**: 完了報告と次のフェーズの計画

## 3. リスク管理

### 3.1 リスク一覧

各フェーズで以下のリスクを想定し、対策を講じます：

| リスク | 影響度 | 対策 |
| :--- | :--- | :--- |
| 認証・認可の不備 | 高 | Phase 0で徹底的にテストし、セキュリティレビューを実施 |
| マルチテナント分離の不備 | 高 | 各フェーズでマルチテナント分離のテストを実施 |
| パフォーマンス問題 | 中 | 各フェーズでパフォーマンステストを実施 |
| データ整合性の問題 | 中 | トランザクション管理を徹底し、整合性チェックを実施 |
| スケジュール遅延 | 中 | 各フェーズで優先順位を明確にし、MVPを優先 |
| 技術的負債の蓄積 | 低 | コードレビューで技術的負債を早期に発見・対応 |

### 3.2 リスク対応フロー

1. **リスクの識別**: 各フェーズ開始時にリスクを識別
2. **リスク評価**: 影響度と発生確率を評価
3. **対策の実施**: リスク対策を実施
4. **モニタリング**: リスクの状況を定期的にモニタリング
5. **見直し**: 必要に応じて対策を見直し

## 4. 開発時の注意事項

### 4.1 マルチテナント分離の徹底

- **常に確認**: 各APIエンドポイントで`company_id`が正しく設定されているか確認
- **テスト**: 他社データにアクセスできないことを必ずテストする
- **コードレビュー**: コードレビューでマルチテナント分離を重点的に確認

### 4.2 セキュリティ

- **認証・認可**: 全てのAPIエンドポイントで認証・認可を実装
- **入力検証**: 全ての入力値を検証する
- **SQLインジェクション対策**: プリペアドステートメントを使用
- **XSS対策**: フレームワーク標準の保護機能を有効化
- **CSRF対策**: フレームワーク標準の保護機能を有効化

### 4.3 パフォーマンス

- **インデックス**: クエリパフォーマンスを考慮したインデックス設計
- **N+1問題**: ORM利用時はEager Loadingを徹底
- **キャッシュ**: 頻繁に参照されるマスタデータはキャッシュを検討
- **大量処理**: チャンク処理を使用（給与計算等）

### 4.4 テスト

- **単体テスト**: 各機能で単体テストを実装
- **統合テスト**: APIエンドポイントの統合テストを実装
- **E2Eテスト**: 主要なフローでE2Eテストを実装
- **マルチテナント分離のテスト**: 重点的に実施

### 4.5 コード品質

- **コーディング規約**: `.cursor/rules`に定義された規約に準拠
- **コードレビュー**: 全ての変更に対してコードレビューを実施
- **リファクタリング**: 技術的負債を定期的に解消

### 4.6 ドキュメント

- **API仕様書**: API変更時は必ず仕様書を更新
- **コードコメント**: 複雑なロジックにはコメントを追加
- **README**: プロジェクトの変更に応じてREADMEを更新

## 5. 開発フロー

### 5.1 機能開発の流れ

1. **要件確認**: 実装する機能の要件を確認
2. **設計**: API設計、データベース設計を確認
3. **実装**: 機能を実装
4. **テスト**: 単体テスト、結合テストを実装・実行
5. **コードレビュー**: Pull Requestを作成し、コードレビューを依頼
6. **マージ**: レビュー完了後、developブランチにマージ
7. **動作確認**: 動作確認を実施

### 5.2 バグ修正の流れ

1. **バグの報告**: Issueを作成
2. **原因調査**: バグの原因を調査
3. **修正**: バグを修正
4. **テスト**: 修正内容をテスト
5. **コードレビュー**: Pull Requestを作成し、コードレビューを依頼
6. **マージ**: レビュー完了後、マージ

### 5.3 緊急修正（hotfix）の流れ

1. **緊急度の判断**: 本番環境への影響を判断
2. **hotfixブランチ作成**: mainブランチからhotfixブランチを作成
3. **修正**: バグを修正
4. **テスト**: 修正内容をテスト
5. **コードレビュー**: 緊急時でもコードレビューを実施（可能な限り）
6. **マージ**: mainブランチとdevelopブランチの両方にマージ
7. **タグ付け**: バージョンタグを付与

## 6. 参考ドキュメント

- [開発順序](./300_概要.md): 開発フェーズの概要
- [Git運用](./310_Git運用.md): ブランチ戦略、コミットメッセージ規約
- [基本設計](../100_基本設計/110_基本設計.md): 機能一覧、画面一覧、権限モデル
- [業務フロー](../100_基本設計/150_業務フロー.md): 勤怠から支払までのプロセス
- [API基本方針](../200_詳細設計/240_API.md): REST方針、認証、エラーハンドリング
- [DB設計方針](../200_詳細設計/221_DB設計.md): マルチテナント、ソフト削除、監査列
- [セキュリティ設計](../200_詳細設計/260_セキュリティー.md): 認証認可、個人情報保護
- [テスト設計](../400_テスト/400_テスト設計.md): テスト方針、重点テスト項目
