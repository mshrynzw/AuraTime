# DDL運用

## 1. マイグレーション管理
- ツール（Flyway, Liquibase, Laravel Migration 等）を用いたバージョン管理を必須とする。
- 本番環境への手動SQL実行は原則禁止。

## 2. 初期データ投入
- **Systemユーザー**: `created_by` / `updated_by` の NOT NULL 制約を満たすため、最初に `id` が固定されたシステム管理用ユーザー（例：system-bot）を作成する。
- **マスタ投入**: `leave_types` や `pay_items` のデフォルトセットをマイグレーション内で投入する。

## 3. ロールバック方針
- 原則、破壊的な変更（カラム削除等）は避け、追加・リネームによる前方互換性を維持する。
- どうしても必要な場合は、リリース前にバックアップを取得し、リストア手順を確立した上で実行する。

## 4. バックアップ・リストア
- AWS RDS の自動バックアップ（Point-in-Time Recovery）を有効化。
- 重要な変更（大規模データ移行等）の前には手動スナップショットを取得する。

## 5. RDS 固有設定
- タイムゾーンは `UTC` を基本とし、表示時に `companies.timezone` に合わせて変換する。
- 全文検索や地理情報が必要な場合は、適切な拡張（pg_bigm, PostGIS）の導入を検討する。

